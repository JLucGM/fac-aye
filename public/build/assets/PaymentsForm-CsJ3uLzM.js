import{r as h,j as e}from"./app-ClBIcqf8.js";import{I as r}from"./input-error-CyLt_G2e.js";import{I as v}from"./input-BhEDF2m4.js";import{L as l}from"./label-B3jNfdOD.js";import{S as x}from"./react-select.esm-ConQ3Ca3.js";import E from"./ConsultationsTable-BEo1fco5.js";import w from"./SubscriptionsTable-Dqa5JOlj.js";import"./utils-bRKmu4jq.js";import"./index-BKT9Wza6.js";import"./index-Ab5rnF_t.js";import"./floating-ui.dom-C5vApqfE.js";import"./table-CYZOIZXe.js";function J({data:t,patients:p=[],paymentMethods:C,consultations:y=[],setData:n,errors:o}){const[m,f]=h.useState([]),[a,I]=h.useState("consulta"),j=Array.isArray(p)?p.map(s=>({value:Number(s.id),label:`${s.name} ${s.lastname} ( C.I: ${s.identification} )`})):[],_=C.map(s=>({value:s.id,label:s.name})),N=[{value:"pendiente",label:"Pendiente"},{value:"pagado",label:"Pagado"},{value:"incobrable",label:"Incobrable"},{value:"reembolsado",label:"Reembolsado"}],S=s=>{let i,c;a==="consulta"?(i=[...t.consultation_ids||[]],c="consultation_ids",n("subscription_ids",[])):(i=[...t.subscription_ids||[]],c="subscription_ids",n("consultation_ids",[])),i.includes(s)?i=i.filter(u=>u!==s):i.push(s),n(c,i);const P=m.filter(u=>i.includes(u.id)).reduce((u,b)=>{let g=0;if(a==="consulta")g=(typeof b.amount=="number"?b.amount:parseFloat(String(b.amount)))||0;else{const d=b;d.subscription&&d.subscription.price!==void 0&&(g=typeof d.subscription.price=="number"?d.subscription.price:parseFloat(String(d.subscription.price)))}return u+(isNaN(g)?0:g)},0);n("amount",P)},k=s=>{const i=s?s.value:null;n("patient_id",i),n("consultation_ids",[]),n("subscription_ids",[]),n("amount",0)};return h.useEffect(()=>{n("payment_type",a)},[a]),h.useEffect(()=>{if(t.patient_id){const s=p.find(i=>i.id===t.patient_id);if(a==="consulta"){const i=y.filter(c=>c.patient_id===t.patient_id&&c.payment_status!=="pagado");f(i)}else if(a==="suscripcion"){const c=((s==null?void 0:s.subscriptions)||[]).filter(F=>F.payment_status!=="pagado");f(c)}}else f([])},[t.patient_id,y,a,p]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment_method_id",children:"Método de Pago"}),e.jsx(x,{id:"payment_method_id",options:_,value:_.find(s=>s.value===t.payment_method_id)||null,onChange:s=>n("payment_method_id",s?s.value:null),isSearchable:!0,placeholder:"Selecciona un método de pago...",className:"rounded-md mt-1 block w-full"}),e.jsx(r,{message:o.payment_method_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"status",className:"mb-2 block font-semibold text-gray-700",children:"Estado del pago"}),e.jsx(x,{id:"status",options:N,value:N.find(s=>s.value===t.status)||null,onChange:s=>n("status",(s==null?void 0:s.value)??""),isSearchable:!0,placeholder:"Select Status...",className:"rounded-md"}),e.jsx(r,{message:o.status})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"reference",children:"Referencia"}),e.jsx(v,{id:"reference",type:"text",name:"reference",value:t.reference,className:"mt-1 block w-full",onChange:s=>n("reference",s.target.value)}),e.jsx(r,{message:o.reference,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[j.length>0&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"patient_id",className:"mb-2 block font-semibold text-gray-700",children:"Paciente"}),e.jsx(x,{id:"patient_id",options:j,value:j.find(s=>s.value===Number(t.patient_id))||null,onChange:k,isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),e.jsx(r,{message:o.patient_id})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"payment_type",className:"mb-2 block font-semibold text-gray-700",children:"Tipo de Pago"}),e.jsx(x,{id:"payment_type",options:[{value:"consulta",label:"Consulta"},{value:"suscripcion",label:"Funcional"}],value:{value:a,label:a==="consulta"?"Consulta":"Funcional"},onChange:s=>{I(s==null?void 0:s.value),n("consultation_ids",[]),n("subscription_ids",[]),n("amount",0)},isSearchable:!0,placeholder:"Selecciona un tipo de pago...",className:"rounded-md"})]})]}),a==="consulta"&&e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{className:"mb-2 block font-semibold text-gray-700",children:"Consultas pendientes a pagar"}),m.length>0?e.jsx(E,{pendingConsultations:m,data:t,toggleConsultationSelection:S}):e.jsx("div",{className:"text-gray-500 text-sm mt-2",children:"No hay consultas pendientes de pago para este paciente."}),e.jsx(r,{message:o.consultation_ids})]}),a==="suscripcion"&&e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{className:"mb-2 block font-semibold text-gray-700",children:"Funcionales pendientes a pagar"}),m.length>0?e.jsx(w,{pendingSubscriptions:m,data:t,toggleSubscriptionSelection:S}):e.jsx("div",{className:"text-gray-500 text-sm mt-2",children:"No hay Funcionales pendientes de pago para este paciente."}),e.jsx(r,{message:o.subscription_ids})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"amount",children:"Monto a pagar"}),e.jsx(v,{id:"amount",type:"text",name:"amount",value:typeof t.amount=="number"?t.amount.toFixed(2):"0.00",className:"mt-1 block w-full bg-gray-200",readOnly:!0}),e.jsx(r,{message:o.amount,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"notes",children:"Notas"}),e.jsx(v,{id:"notes",type:"text",name:"notes",value:t.notes,className:"mt-1 block w-full",onChange:s=>n("notes",s.target.value)}),e.jsx(r,{message:o.notes,className:"mt-2"})]})]})}export{J as default};
