import{r as m,m as p,j as e,L as w}from"./app--xgSMu8m.js";import{C as S}from"./content-layout-BOG04L-D.js";import{B as r}from"./button-BGZQJ0Ba.js";import z from"./ConsultationsForm-TqPgOQBc.js";import{H as A}from"./heading--swNWzJW.js";import H from"./MedicalRecordForm-BFA-cZsS.js";import{D as F,a as O,b as I,c as L,d as P,e as T,f as k}from"./dialog-B5dOCHub.js";import{M as B}from"./MedicalRecordTimeline-BS3zDvju.js";import{D as G}from"./download-sw9m7xny.js";import"./app-logo-icon-CnfBnbLe.js";import"./index-BwWXEq4-.js";import"./utils-bRKmu4jq.js";import"./chevron-right-D_nz7_XC.js";import"./createLucideIcon-DF-M5Tia.js";import"./index-CO6rcehI.js";import"./Combination-LpGtPM2s.js";import"./floating-ui.dom-C5vApqfE.js";import"./chevron-down-B3ssbDY0.js";import"./input-error-D0cdDPbS.js";import"./input-DD0sThBW.js";import"./label-BTtlpCFn.js";import"./react-select.esm-I3F71os0.js";import"./format-55BtSZzO.js";import"./ServicesTable-CszX4rlT.js";import"./table-CIfXD-Dd.js";import"./textarea-CIS4Z3zd.js";import"./index-sDSE_iwK.js";import"./index-DwLL3azA.js";import"./check-CS4bnaur.js";import"./chevron-up-DOR-v96a.js";import"./eye-CfeKgB3N.js";const V=[{title:"Inicio",href:"/dashboard"},{title:"Consultations",href:"/consultations"},{title:"Editar Consulta",href:"#"}];function Me({consultation:i,patients:u,users:h,services:x,paymentMethods:q}){var n;console.log("Consultation Data:",i);const[g,s]=m.useState(!1),[t,f]=m.useState(null),{data:_,setData:j,errors:b,put:D}=p({user_id:i.user_id,patient_id:i.patient_id,service_id:((n=i.services)==null?void 0:n.map(a=>a.id))??[],status:i.status,scheduled_at:i.scheduled_at?new Date(i.scheduled_at).toISOString().slice(0,16):"",notes:i.notes||"",payment_status:i.payment_status||"",consultation_type:i.consultation_type||"",amount:i.amount||0,subscription_use:i.patient_subscription_id?"yes":"no"}),M=a=>{a.preventDefault(),D(route("consultations.update",i.id))},{data:R,setData:d,errors:y,post:v,put:C,reset:l,processing:c}=p({patient_id:i.patient_id,consultation_id:i.id,title:"",anamnesis:"",pain_behavior:"",description:"",type:"consulta"}),N=a=>{a.preventDefault(),t?C(route("medical-records.update",t.id),{onSuccess:()=>{l(),s(!1),window.location.reload()},onError:o=>{console.error("Error al actualizar Medical Record:",o)}}):v(route("medical-records.store"),{onSuccess:()=>{l(),s(!1),window.location.reload()},onError:o=>{console.error("Error al crear Medical Record:",o)}})},E=a=>{f(a),d({patient_id:a.patient_id,consultation_id:a.consultation_id??0,title:a.title,anamnesis:a.anamnesis||"",pain_behavior:a.pain_behavior||"",description:a.description||"",type:a.type}),s(!0)};return e.jsxs(S,{breadcrumbs:V,children:[e.jsx(w,{title:"Editar Consulta"}),e.jsx(A,{title:"Editar consulta",description:"Modifica los detalles de la consulta y la información de pago.",children:e.jsxs("div",{className:"",children:[e.jsxs(F,{open:g,onOpenChange:s,children:[e.jsx(O,{asChild:!0,children:(!i.medical_records||i.medical_records.length===0)&&e.jsx(r,{variant:"outline",className:"me-4",children:"Añadir Nuevo Registro Médico"})}),e.jsxs(I,{className:"sm:max-w-[550px]",children:[e.jsxs(L,{children:[e.jsx(P,{children:t?"Actualizar Registro Médico":"Añadir Nuevo Registro Médico"}),e.jsxs(T,{children:["Completa los detalles para ",t?"actualizar":"añadir"," un registro al historial del paciente."]})]}),e.jsxs("form",{onSubmit:N,className:"grid gap-4 py-4",children:[e.jsx(H,{data:R,setData:d,errors:y}),e.jsx(k,{children:e.jsx(r,{type:"submit",disabled:c,children:c?"Guardando...":t?"Actualizar Registro Médico":"Guardar Registro Médico"})})]})]})]}),e.jsxs(r,{variant:"default",onClick:()=>window.open(route("consultationpdf",i.id),"_blank"),children:[e.jsx(G,{}),"Descargar Comprobante"]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Detalles de la Consulta"}),e.jsxs("form",{className:"flex flex-col gap-4",onSubmit:M,children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4",children:e.jsx(z,{data:{..._,patient:i.patient},patients:u,users:h,services:x,setData:j,errors:b})}),e.jsx(r,{type:"submit",variant:"default",children:"Actualizar Consulta"})]})]}),i.medical_records&&i.medical_records.length>0&&e.jsxs("div",{className:"mt-8 py-6 ",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Historial Médico del Paciente"}),e.jsx(B,{medicalRecords:i.medical_records||[],initialVisibleCount:3,onEdit:E})]}),(!i.medical_records||i.medical_records.length===0)&&e.jsxs("div",{className:"mt-8 py-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Historial Médico del Paciente"}),e.jsx("p",{className:"text-gray-600",children:"No hay registros médicos asociados a esta consulta."})]})]})}export{Me as default};
