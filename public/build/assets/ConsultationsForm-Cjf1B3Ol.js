import{r as _,j as s}from"./app-xOoa6HPd.js";import{I as d}from"./input-error-B3TWQCeb.js";import{I as k}from"./input-D3BiNtE6.js";import{L as o}from"./label-DJSHCchO.js";import{S as m}from"./react-select.esm-CA10u9P8.js";import E from"./ServicesTable-DG1o8w2m.js";import"./utils-bRKmu4jq.js";import"./index-DzIYgzR8.js";import"./index-DuDXMw8I.js";import"./floating-ui.dom-C5vApqfE.js";import"./table-CjD9jXok.js";function B({data:i,patients:p=[],users:S,services:t,setData:n,errors:c,activeSubscription:F}){var f,j,N;const h=S.map(e=>({value:String(e.id),label:e.name+" "+e.lastname})),b=i.patient||p.find(e=>e.id===i.patient_id),a=F??((f=b==null?void 0:b.subscriptions)==null?void 0:f.find(e=>e.status==="active")),C=!!a,x=Array.isArray(p)?p.map(e=>({value:String(e.id),label:`${e.name} ${e.lastname} ( C.I: ${e.identification} )`})):[],v=t.map(e=>({value:String(e.id),label:`${e.name} - $ ${e.price}`})),g=i.service_id.some(e=>{const l=t.find(r=>r.id===e);return l==null?void 0:l.is_courtesy});_.useEffect(()=>{g&&i.subscription_use==="no"&&n("payment_status","pagado")},[g,i.subscription_use]),i.subscription_use;const y=[{value:"consultorio",label:"Consultorio"},{value:"domiciliaria",label:"Domiciliaria"}];return _.useEffect(()=>{const e=i.service_id.reduce((l,r)=>{const u=t.find($=>$.id===r);return l+(i.subscription_use==="yes"?0:parseFloat(String((u==null?void 0:u.price)??"0")))},0);n("amount",e)},[i.service_id,i.subscription_use,t]),_.useEffect(()=>{i.subscription_use==="yes"?(n("service_id",[]),n("payment_status","pagado")):n("payment_status","pendiente")},[i.subscription_use]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx(o,{htmlFor:"user_id",className:"my-2 block font-semibold text-gray-700",children:"Fisioterapeuta"}),s.jsx(m,{id:"user_id",options:h,value:h.find(e=>e.value===String(i.user_id))||null,onChange:e=>n("user_id",e?Number(e.value):null),isSearchable:!0,placeholder:"Selecciona un fisioterapeuta...",className:"rounded-md"}),s.jsx(o,{htmlFor:"user_id",className:"text-gray-500 text-sm",children:"Fisioterapeuta que tratera al paciente."}),s.jsx(d,{message:c.user_id})]}),x.length>0&&s.jsxs("div",{children:[s.jsx(o,{htmlFor:"patient_id",className:"my-2 block font-semibold text-gray-700",children:"Paciente"}),s.jsx(m,{id:"patient_id",options:x,value:x.find(e=>e.value===String(i.patient_id))||null,onChange:e=>n("patient_id",e?Number(e.value):null),isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),s.jsx(o,{htmlFor:"patient_id",className:"text-gray-500 text-sm",children:"Seleccione al paciente a tratar."}),s.jsx(d,{message:c.patient_id})]}),s.jsxs("div",{children:[s.jsx(o,{htmlFor:"consultation_type",className:"my-2 block font-semibold text-gray-700",children:"Tipo de asistencia"}),s.jsx(m,{id:"consultation_type",options:y,value:y.find(e=>e.value===i.consultation_type)||null,onChange:e=>n("consultation_type",(e==null?void 0:e.value)??""),isSearchable:!0,placeholder:"Selecciona el tipo de asistencia...",className:"rounded-md"}),s.jsx(d,{message:c.consultation_type})]}),C&&s.jsxs("div",{className:"",children:[s.jsxs("div",{children:[s.jsx(o,{htmlFor:"subscription_use",className:"my-2 block font-semibold text-gray-700",children:"¿Usar Funcional?"}),s.jsx(m,{id:"subscription_use",options:[{value:"no",label:"No usar funcional"},{value:"yes",label:"Usar funcional"}],value:i.subscription_use==="yes"?{value:"yes",label:"Usar funcional"}:{value:"no",label:"No usar funcional"},onChange:e=>n("subscription_use",(e==null?void 0:e.value)||"no"),isSearchable:!0,placeholder:"Selecciona...",className:"rounded-md"})]}),i.subscription_use==="yes"&&s.jsxs("p",{className:"text-gray-500 text-sm",children:["Se aplicará la funcional #",a==null?void 0:a.id," (Asistencias restantes: ",a==null?void 0:a.consultations_remaining,")"]}),i.subscription_use==="no"&&s.jsxs("p",{className:"text-gray-500 text-sm",children:["No se aplicará ninguna funcionalidad adicional. ",s.jsx("br",{}),"Una vez creada la asistencia, si eliminas el uso de la funcional, se reintegrará la asistencia usada."]})]}),s.jsxs("div",{className:"col-span-full",children:[s.jsx(o,{htmlFor:"service_id",className:"my-2 block font-semibold text-gray-700",children:"Servicios"}),i.subscription_use==="yes"&&a?s.jsx("input",{type:"text",readOnly:!0,value:((j=a.subscription)==null?void 0:j.name)||a.name,className:"w-full rounded-md border border-gray-300 bg-gray-100 p-2"}):s.jsx(m,{id:"service_id",options:v,isMulti:!0,value:v.filter(e=>i.service_id.map(String).includes(e.value)),onChange:e=>n("service_id",(e||[]).map(l=>Number(l.value))),isSearchable:!0,placeholder:"Selecciona servicios...",className:"rounded-md",isDisabled:i.subscription_use==="yes"}),s.jsx(o,{htmlFor:"service_id",className:"text-gray-500 text-sm",children:"Seleccione los servicios a los que se aplicará al paciente."}),s.jsx(d,{message:c.service_id})]}),s.jsx(E,{className:"col-span-full",services:i.subscription_use==="yes"&&a?[{id:`subscription-${a.id}`,name:((N=a.subscription)==null?void 0:N.name)||a.name,price:0}]:i.service_id.map(e=>{const l=t.find(r=>r.id===e);return{...l,price:l?l.price:0}})}),s.jsx("div",{className:"flex justify-end font-bold text-lg col-span-full",children:s.jsxs("div",{className:"border px-4 py-2 rounded-sm bg-gray-100",children:["Total: $",i.service_id.reduce((e,l)=>{const r=t.find(u=>u.id===l);return e+(i.subscription_use==="yes"?0:parseFloat(String((r==null?void 0:r.price)??"0")))},0).toFixed(2)]})}),s.jsxs("div",{className:"col-span-full",children:[s.jsx(o,{htmlFor:"notes",className:"my-2 block font-semibold text-gray-700",children:"Notas (Opcional)"}),s.jsx(k,{id:"notes",type:"text",value:i.notes,onChange:e=>n("notes",e.target.value),className:"rounded-md"}),s.jsx(o,{htmlFor:"notes",className:"text-gray-500 text-sm",children:"Notas de la asistencia."}),s.jsx(d,{message:c.notes})]})]})}export{B as default};
