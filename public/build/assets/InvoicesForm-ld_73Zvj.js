import{j as e}from"./app-efENkHWt.js";import{I as c}from"./input-error-De3ySyKP.js";import{I as u}from"./input-BmTjbIX6.js";import{L as r}from"./label-BWZsqXZl.js";import{S as v}from"./react-select.esm-CTkb7eTn.js";import{B as g}from"./button-D68pe1qA.js";import{T as $}from"./textarea-BDbkpo6N.js";import{T as C,a as I,b as h,c as d,d as S,e as i}from"./table-BHnuCnsP.js";import{T as q}from"./trash-DX_eabmx.js";import"./utils-bRKmu4jq.js";import"./index-pYX6Rk_K.js";import"./index-DhVMpW3F.js";import"./floating-ui.dom-C5vApqfE.js";import"./index-dkW4UkYo.js";import"./createLucideIcon-B5WZNrw5.js";function Q({data:s,setData:l,errors:n,patients:_,paymentMethods:N}){const p=_.map(t=>({value:t.id,label:`${t.name} ${t.lastname} (C.I: ${t.identification})`})),x=N.map(t=>({value:t.id,label:t.name})),b=()=>{l("items",[...s.items,{id:null,service_name:"",quantity:1,unit_price:0,line_total:0}])},f=t=>{const a=[...s.items];a.splice(t,1),l("items",a)},j=(t,a,m)=>{const o=[...s.items];if(o[t]={...o[t],[a]:m},a==="quantity"||a==="unit_price"){const F=o[t].quantity||0,T=o[t].unit_price||0;o[t].line_total=F*T}l("items",o)},y=()=>s.items.reduce((t,a)=>t+parseFloat(a.line_total),0),w=t=>Math.floor(t*100)/100;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"invoice_number",children:"Número de Factura"}),e.jsx(u,{id:"invoice_number",type:"text",name:"invoice_number",value:s.invoice_number,className:"block w-full",onChange:t=>l("invoice_number",t.target.value)}),e.jsx(r,{htmlFor:"invoice_number",className:"text-gray-500 text-sm",children:"Se auto-generación de números de factura, puede personalizarlo."}),e.jsx(c,{message:n.invoice_number,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"invoice_date",children:"Fecha de Factura"}),e.jsx(u,{id:"invoice_date",type:"date",name:"invoice_date",value:s.invoice_date,className:"block w-full",onChange:t=>l("invoice_date",t.target.value)}),e.jsx(c,{message:n.invoice_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"patient_id",children:"Paciente"}),e.jsx(v,{id:"patient_id",options:p,value:p.find(t=>t.value===s.patient_id)||null,onChange:t=>{var a;return l("patient_id",t?t.value:((a=p[0])==null?void 0:a.value)||null)},isSearchable:!0,placeholder:"Selecciona un paciente...",className:"block w-full"}),e.jsx(c,{message:n.patient_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"payment_method_id",children:"Método de Pago"}),e.jsx(v,{id:"payment_method_id",options:x,value:x.find(t=>t.value===s.payment_method_id)||null,onChange:t=>{var a;return l("payment_method_id",t?t.value:((a=x[0])==null?void 0:a.value)||null)},isSearchable:!0,placeholder:"Selecciona un método de pago...",className:"block w-full"}),e.jsx(c,{message:n.payment_method_id,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"notes",children:"Notas (opcional)"}),e.jsx($,{id:"notes",name:"notes",value:s.notes,className:"mt-1 block w-full",onChange:t=>l("notes",t.target.value)}),e.jsx(r,{htmlFor:"notes",className:"text-gray-500 text-sm",children:"Notas sobre la factura."}),e.jsx(c,{message:n.notes,className:"mt-2"})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-3",children:"Ítems de la Factura"}),e.jsx("div",{className:"overflow-x-auto rounded-md border",children:e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs(h,{children:[e.jsx(d,{className:"w-[15%]",children:"Cantidad"}),e.jsx(d,{className:"w-[40%] text-right",children:"Descripción"}),e.jsx(d,{className:"w-[20%] text-right",children:"P. Unitario"}),e.jsx(d,{className:"w-[20%] text-right",children:"Total"}),e.jsx(d,{className:"w-[5%] text-right",children:"Acción"})]})}),e.jsxs(S,{children:[s.items.length===0?e.jsx(h,{children:e.jsx(i,{colSpan:5,className:"h-24 text-center",children:"No hay ítems en la factura."})}):s.items.map((t,a)=>e.jsxs(h,{children:[e.jsxs(i,{className:"text-right",children:[e.jsx(u,{id:`quantity_${a}`,type:"number",name:`items[${a}][quantity]`,value:t.quantity,className:"w-full",onChange:m=>j(a,"quantity",parseInt(m.target.value)||0),min:1}),e.jsx(c,{message:n[`items.${a}.quantity`],className:"mt-1"})]}),e.jsxs(i,{children:[e.jsx(u,{id:`service_name_${a}`,type:"text",name:`items[${a}][service_name]`,value:t.service_name,className:"w-full",onChange:m=>j(a,"service_name",m.target.value)}),e.jsx(c,{message:n[`items.${a}.service_name`],className:"mt-1"})]}),e.jsxs(i,{className:"text-right",children:[e.jsx(u,{id:`unit_price_${a}`,type:"number",name:`items[${a}][unit_price]`,value:t.unit_price,className:"w-full",onChange:m=>j(a,"unit_price",parseFloat(m.target.value)||0),min:0,step:"0.01"}),e.jsx(c,{message:n[`items.${a}.unit_price`],className:"mt-1"})]}),e.jsx(i,{className:"text-right",children:e.jsx(u,{id:`line_total_${a}`,type:"number",value:t.line_total,className:"w-full bg-gray-100 dark:bg-gray-800 text-right",readOnly:!0})}),e.jsx(i,{className:"text-right",children:e.jsx(g,{type:"button",variant:"destructive",size:"icon",onClick:()=>f(a),children:e.jsx(q,{className:"h-4 w-4"})})})]},t.id||`new-${a}`)),e.jsxs(h,{children:[e.jsx(i,{}),e.jsx(i,{}),e.jsx(i,{}),e.jsxs(i,{colSpan:1,className:"text-right font-semibold",children:["Total: $",w(y()).toFixed(2)]})]})]})]})}),e.jsx(g,{type:"button",variant:"outline",onClick:b,className:"mt-4",children:"Agregar Ítem"})]})}export{Q as default};
