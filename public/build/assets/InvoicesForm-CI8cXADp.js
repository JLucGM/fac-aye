import{j as e}from"./app-ClBIcqf8.js";import{I as c}from"./input-error-CyLt_G2e.js";import{I as r}from"./input-BhEDF2m4.js";import{L as u}from"./label-B3jNfdOD.js";import{S as p}from"./react-select.esm-ConQ3Ca3.js";import{B as v}from"./button-QIBx4eB1.js";import{T as C}from"./textarea-0Xu-JuGy.js";import{T as F,a as I,b as h,c as d,d as T,e as l}from"./table-CYZOIZXe.js";import{T as q}from"./trash-VVugMAws.js";import"./utils-bRKmu4jq.js";import"./index-BKT9Wza6.js";import"./index-Ab5rnF_t.js";import"./floating-ui.dom-C5vApqfE.js";import"./createLucideIcon-o9RIc1Ws.js";function J({data:t,setData:i,errors:n,patients:_,paymentMethods:N}){const x=_.map(s=>({value:s.id,label:`${s.name} ${s.lastname} (C.I: ${s.identification})`})),g=N.map(s=>({value:s.id,label:s.name})),f=()=>{i("items",[...t.items,{id:null,service_name:"",quantity:1,unit_price:0,line_total:0}])},b=s=>{const a=[...t.items];a.splice(s,1),i("items",a)},j=(s,a,m)=>{const o=[...t.items];if(o[s]={...o[s],[a]:m},a==="quantity"||a==="unit_price"){const w=o[s].quantity||0,$=o[s].unit_price||0;o[s].line_total=w*$}i("items",o)},y=()=>t.items.reduce((s,a)=>s+a.line_total,0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"invoice_img",children:"Adjuntar factura"}),e.jsx(r,{id:"invoice_img",type:"file",name:"invoice_img",className:"mt-1 block w-full",onChange:s=>{s.target.files&&s.target.files.length>0?i("invoice_img",Array.from(s.target.files)):i("invoice_img",null)},accept:"image/*"}),e.jsx(c,{message:n.invoice_img,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"invoice_number",children:"Número de Factura"}),e.jsx(r,{id:"invoice_number",type:"text",name:"invoice_number",value:t.invoice_number,className:"mt-1 block w-full",onChange:s=>i("invoice_number",s.target.value)}),e.jsx(c,{message:n.invoice_number,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"invoice_date",children:"Fecha de Factura"}),e.jsx(r,{id:"invoice_date",type:"date",name:"invoice_date",value:t.invoice_date,className:" block w-full",onChange:s=>i("invoice_date",s.target.value)}),e.jsx(c,{message:n.invoice_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"patient_id",children:"Paciente"}),e.jsx(p,{id:"patient_id",options:x,value:x.find(s=>s.value===t.patient_id)||null,onChange:s=>i("patient_id",s?s.value:null),isSearchable:!0,placeholder:"Selecciona un paciente...",className:"block w-full"}),e.jsx(c,{message:n.patient_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"payment_method_id",children:"Método de Pago"}),e.jsx(p,{id:"payment_method_id",options:g,value:g.find(s=>s.value===t.payment_method_id)||null,onChange:s=>i("payment_method_id",s?s.value:null),isSearchable:!0,placeholder:"Selecciona un método de pago...",className:"block w-full"}),e.jsx(c,{message:n.payment_method_id,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"notes",children:"Notas"}),e.jsx(C,{id:"notes",name:"notes",value:t.notes,className:"mt-1 block w-full",onChange:s=>i("notes",s.target.value)}),e.jsx(c,{message:n.notes,className:"mt-2"})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-3",children:"Ítems de la Factura"}),e.jsx("div",{className:"overflow-x-auto rounded-md border",children:e.jsxs(F,{children:[e.jsx(I,{children:e.jsxs(h,{children:[e.jsx(d,{className:"w-[15%]",children:"Cantidad"}),e.jsx(d,{className:"w-[40%] text-right",children:"Descripción"}),e.jsx(d,{className:"w-[20%] text-right",children:"P. Unitario"}),e.jsx(d,{className:"w-[20%] text-right",children:"Total"}),e.jsx(d,{className:"w-[5%] text-right",children:"Acción"})]})}),e.jsxs(T,{children:[t.items.length===0?e.jsx(h,{children:e.jsx(l,{colSpan:5,className:"h-24 text-center",children:"No hay ítems en la factura."})}):t.items.map((s,a)=>e.jsxs(h,{children:[e.jsxs(l,{className:"text-right",children:[e.jsx(r,{id:`quantity_${a}`,type:"number",name:`items[${a}][quantity]`,value:s.quantity,className:"w-full",onChange:m=>j(a,"quantity",parseInt(m.target.value)||0),min:"1"}),e.jsx(c,{message:n[`items.${a}.quantity`],className:"mt-1"})]}),e.jsxs(l,{children:[e.jsx(r,{id:`service_name_${a}`,type:"text",name:`items[${a}][service_name]`,value:s.service_name,className:"w-full",onChange:m=>j(a,"service_name",m.target.value)}),e.jsx(c,{message:n[`items.${a}.service_name`],className:"mt-1"})]}),e.jsxs(l,{className:"text-right",children:[e.jsx(r,{id:`unit_price_${a}`,type:"number",name:`items[${a}][unit_price]`,value:s.unit_price,className:"w-full",onChange:m=>j(a,"unit_price",parseFloat(m.target.value)||0)}),e.jsx(c,{message:n[`items.${a}.unit_price`],className:"mt-1"})]}),e.jsx(l,{className:"text-right",children:e.jsx(r,{id:`line_total_${a}`,type:"number",value:s.line_total,className:"w-full bg-gray-100 dark:bg-gray-800 text-right",readOnly:!0})}),e.jsx(l,{className:"text-right",children:e.jsx(v,{type:"button",variant:"destructive",size:"icon",onClick:()=>b(a),children:e.jsx(q,{className:"h-4 w-4"})})})]},s.id||`new-${a}`)),e.jsxs(h,{children:[e.jsx(l,{}),e.jsx(l,{}),e.jsx(l,{}),e.jsx(l,{colSpan:1,className:"text-right",children:e.jsxs("p",{children:["Total: $",y().toFixed(2)]})})]})]})]})}),e.jsx(v,{type:"button",variant:"outline",onClick:f,className:"mt-4",children:"Agregar"})]})}export{J as default};
