import{r as j,j as s}from"./app-efENkHWt.js";import{I as d}from"./input-error-De3ySyKP.js";import{I as $}from"./input-BmTjbIX6.js";import{L as n}from"./label-BWZsqXZl.js";import{S as m}from"./react-select.esm-CTkb7eTn.js";import k from"./ServicesTable-UI98R4_1.js";import"./utils-bRKmu4jq.js";import"./index-pYX6Rk_K.js";import"./index-DhVMpW3F.js";import"./floating-ui.dom-C5vApqfE.js";import"./table-BHnuCnsP.js";function z({data:i,patients:p=[],users:N,services:t,setData:l,errors:c,activeSubscription:S}){var y,_,f;const h=N.map(e=>({value:String(e.id),label:e.name+" "+e.lastname})),x=i.patient||p.find(e=>e.id===i.patient_id),a=S??((y=x==null?void 0:x.subscriptions)==null?void 0:y.find(e=>e.status==="active")),F=!!a,b=Array.isArray(p)?p.map(e=>({value:String(e.id),label:`${e.name} ${e.lastname} ( C.I: ${e.identification} )`})):[],v=t.map(e=>({value:String(e.id),label:`${e.name} - $ ${e.price}`}));i.subscription_use;const g=[{value:"consultorio",label:"Consultorio"},{value:"domiciliaria",label:"Domiciliaria"}];return j.useEffect(()=>{const e=i.service_id.reduce((r,o)=>{const u=t.find(C=>C.id===o);return r+(i.subscription_use==="yes"?0:parseFloat(String((u==null?void 0:u.price)??"0")))},0);l("amount",e)},[i.service_id,i.subscription_use,t]),j.useEffect(()=>{i.subscription_use==="yes"?(l("service_id",[]),l("payment_status","pagado")):l("payment_status","pendiente")},[i.subscription_use]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx(n,{htmlFor:"user_id",className:"my-2 block font-semibold text-gray-700",children:"Fisioterapeuta"}),s.jsx(m,{id:"user_id",options:h,value:h.find(e=>e.value===String(i.user_id))||null,onChange:e=>l("user_id",e?Number(e.value):null),isSearchable:!0,placeholder:"Selecciona un fisioterapeuta...",className:"rounded-md"}),s.jsx(n,{htmlFor:"user_id",className:"text-gray-500 text-sm",children:"Fisioterapeuta que tratera al paciente."}),s.jsx(d,{message:c.user_id})]}),b.length>0&&s.jsxs("div",{children:[s.jsx(n,{htmlFor:"patient_id",className:"my-2 block font-semibold text-gray-700",children:"Paciente"}),s.jsx(m,{id:"patient_id",options:b,value:b.find(e=>e.value===String(i.patient_id))||null,onChange:e=>l("patient_id",e?Number(e.value):null),isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),s.jsx(n,{htmlFor:"patient_id",className:"text-gray-500 text-sm",children:"Seleccione al paciente a tratar."}),s.jsx(d,{message:c.patient_id})]}),s.jsxs("div",{children:[s.jsx(n,{htmlFor:"consultation_type",className:"my-2 block font-semibold text-gray-700",children:"Tipo de asistencia"}),s.jsx(m,{id:"consultation_type",options:g,value:g.find(e=>e.value===i.consultation_type)||null,onChange:e=>l("consultation_type",(e==null?void 0:e.value)??""),isSearchable:!0,placeholder:"Selecciona el tipo de asistencia...",className:"rounded-md"}),s.jsx(d,{message:c.consultation_type})]}),F&&s.jsxs("div",{className:"",children:[s.jsxs("div",{children:[s.jsx(n,{htmlFor:"subscription_use",className:"my-2 block font-semibold text-gray-700",children:"¿Usar Funcional?"}),s.jsx(m,{id:"subscription_use",options:[{value:"no",label:"No usar funcional"},{value:"yes",label:"Usar funcional"}],value:i.subscription_use==="yes"?{value:"yes",label:"Usar funcional"}:{value:"no",label:"No usar funcional"},onChange:e=>l("subscription_use",(e==null?void 0:e.value)||"no"),isSearchable:!0,placeholder:"Selecciona...",className:"rounded-md"})]}),i.subscription_use==="yes"&&s.jsxs("p",{className:"text-gray-500 text-sm",children:["Se aplicará la funcional #",a==null?void 0:a.id," (Asistencias restantes: ",a==null?void 0:a.consultations_remaining,")"]}),i.subscription_use==="no"&&s.jsxs("p",{className:"text-gray-500 text-sm",children:["No se aplicará ninguna funcionalidad adicional. ",s.jsx("br",{}),"Una vez creada la asistencia, si eliminas el uso de la funcional, se reintegrará la asistencia usada."]})]}),s.jsxs("div",{className:"col-span-full",children:[s.jsx(n,{htmlFor:"service_id",className:"my-2 block font-semibold text-gray-700",children:"Servicios"}),i.subscription_use==="yes"&&a?s.jsx("input",{type:"text",readOnly:!0,value:((_=a.subscription)==null?void 0:_.name)||a.name,className:"w-full rounded-md border border-gray-300 bg-gray-100 p-2"}):s.jsx(m,{id:"service_id",options:v,isMulti:!0,value:v.filter(e=>i.service_id.map(String).includes(e.value)),onChange:e=>l("service_id",(e||[]).map(r=>Number(r.value))),isSearchable:!0,placeholder:"Selecciona servicios...",className:"rounded-md",isDisabled:i.subscription_use==="yes"}),s.jsx(n,{htmlFor:"service_id",className:"text-gray-500 text-sm",children:"Seleccione los servicios a los que se aplicará al paciente."}),s.jsx(d,{message:c.service_id})]}),s.jsx(k,{className:"col-span-full",services:i.subscription_use==="yes"&&a?[{id:`subscription-${a.id}`,name:((f=a.subscription)==null?void 0:f.name)||a.name,price:0}]:i.service_id.map(e=>{const r=t.find(o=>o.id===e);return{...r,price:r?r.price:0}})}),s.jsx("div",{className:"flex justify-end font-bold text-lg col-span-full",children:s.jsxs("div",{className:"border px-4 py-2 rounded-sm bg-gray-100",children:["Total: $",i.service_id.reduce((e,r)=>{const o=t.find(u=>u.id===r);return e+(i.subscription_use==="yes"?0:parseFloat(String((o==null?void 0:o.price)??"0")))},0).toFixed(2)]})}),s.jsxs("div",{className:"col-span-full",children:[s.jsx(n,{htmlFor:"notes",className:"my-2 block font-semibold text-gray-700",children:"Notas (Opcional)"}),s.jsx($,{id:"notes",type:"text",value:i.notes,onChange:e=>l("notes",e.target.value),className:"rounded-md"}),s.jsx(n,{htmlFor:"notes",className:"text-gray-500 text-sm",children:"Notas de la asistencia."}),s.jsx(d,{message:c.notes})]})]})}export{z as default};
