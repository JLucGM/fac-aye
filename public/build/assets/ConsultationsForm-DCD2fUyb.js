import{r as j,j as s}from"./app-DG4aA9SL.js";import{I as d}from"./input-error-Cipe4zPI.js";import{I as $}from"./input-DWCzJmWe.js";import{L as n}from"./label-CciWg7BY.js";import{S as m}from"./react-select.esm-BXYZYRzm.js";import k from"./ServicesTable-Cf-o9lfO.js";import"./utils-bRKmu4jq.js";import"./index-DbAlyxNN.js";import"./index-B_bdB6qp.js";import"./floating-ui.dom-C5vApqfE.js";import"./table-CeY2YHMD.js";function z({data:i,patients:p=[],users:N,services:t,setData:a,errors:c,activeSubscription:S}){var f,y,g;const h=N.map(e=>({value:String(e.id),label:e.name+" "+e.lastname})),x=i.patient||p.find(e=>e.id===i.patient_id),l=S??((f=x==null?void 0:x.subscriptions)==null?void 0:f.find(e=>e.status==="active")),F=!!l,b=Array.isArray(p)?p.map(e=>({value:String(e.id),label:`${e.name} ${e.lastname} ( C.I: ${e.identification} )`})):[],v=t.map(e=>({value:String(e.id),label:`${e.name} - $ ${e.price}`}));i.subscription_use;const _=[{value:"consultorio",label:"Consultorio"},{value:"domiciliaria",label:"Domiciliaria"}];return j.useEffect(()=>{const e=i.service_id.reduce((o,r)=>{const u=t.find(C=>C.id===r);return o+(i.subscription_use==="yes"?0:parseFloat((u==null?void 0:u.price)||"0"))},0);a("amount",e)},[i.service_id,i.subscription_use,t]),j.useEffect(()=>{i.subscription_use==="yes"?(a("service_id",[]),a("payment_status","pagado")):a("payment_status","pendiente")},[i.subscription_use]),s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx(n,{htmlFor:"user_id",className:"my-2 block font-semibold text-gray-700",children:"Fisioterapeuta"}),s.jsx(m,{id:"user_id",options:h,value:h.find(e=>e.value===String(i.user_id))||null,onChange:e=>a("user_id",e?Number(e.value):null),isSearchable:!0,placeholder:"Selecciona un fisioterapeuta...",className:"rounded-md"}),s.jsx(n,{htmlFor:"user_id",className:"text-gray-500 text-sm",children:"Fisioterapeuta que tratera al paciente."}),s.jsx(d,{message:c.user_id})]}),b.length>0&&s.jsxs("div",{children:[s.jsx(n,{htmlFor:"patient_id",className:"my-2 block font-semibold text-gray-700",children:"Paciente"}),s.jsx(m,{id:"patient_id",options:b,value:b.find(e=>e.value===String(i.patient_id))||null,onChange:e=>a("patient_id",e?Number(e.value):null),isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),s.jsx(n,{htmlFor:"patient_id",className:"text-gray-500 text-sm",children:"Seleccione al paciente a tratar."}),s.jsx(d,{message:c.patient_id})]}),s.jsxs("div",{children:[s.jsx(n,{htmlFor:"consultation_type",className:"my-2 block font-semibold text-gray-700",children:"Tipo de Consulta"}),s.jsx(m,{id:"consultation_type",options:_,value:_.find(e=>e.value===i.consultation_type)||null,onChange:e=>a("consultation_type",(e==null?void 0:e.value)??""),isSearchable:!0,placeholder:"Selecciona el tipo de consulta...",className:"rounded-md"}),s.jsx(d,{message:c.consultation_type})]}),F&&s.jsxs("div",{className:"",children:[s.jsxs("div",{children:[s.jsx(n,{htmlFor:"subscription_use",className:"my-2 block font-semibold text-gray-700",children:"¿Usar Funcional?"}),s.jsx(m,{id:"subscription_use",options:[{value:"no",label:"No usar funcional"},{value:"yes",label:"Usar funcional"}],value:i.subscription_use==="yes"?{value:"yes",label:"Usar funcional"}:{value:"no",label:"No usar funcional"},onChange:e=>a("subscription_use",(e==null?void 0:e.value)||"no"),isSearchable:!0,placeholder:"Selecciona...",className:"rounded-md"})]}),i.subscription_use==="yes"&&s.jsxs("p",{className:"text-gray-500 text-sm",children:["Se aplicará la funcional #",l==null?void 0:l.id," (Consultas restantes: ",l==null?void 0:l.consultations_remaining,")"]}),i.subscription_use==="no"&&s.jsxs("p",{className:"text-gray-500 text-sm",children:["No se aplicará ninguna funcionalidad adicional. ",s.jsx("br",{}),"Una vez creada la asistencia, si eliminas el uso de la funcional, se reintegrará la consulta usada."]})]}),s.jsxs("div",{className:"col-span-full",children:[s.jsx(n,{htmlFor:"service_id",className:"my-2 block font-semibold text-gray-700",children:"Servicios"}),i.subscription_use==="yes"&&l?s.jsx("input",{type:"text",readOnly:!0,value:((y=l.subscription)==null?void 0:y.name)||l.name,className:"w-full rounded-md border border-gray-300 bg-gray-100 p-2"}):s.jsx(m,{id:"service_id",options:v,isMulti:!0,value:v.filter(e=>i.service_id.map(String).includes(e.value)),onChange:e=>a("service_id",(e||[]).map(o=>Number(o.value))),isSearchable:!0,placeholder:"Selecciona servicios...",className:"rounded-md",isDisabled:i.subscription_use==="yes"}),s.jsx(n,{htmlFor:"service_id",className:"text-gray-500 text-sm",children:"Seleccione los servicios a los que se aplicará al paciente."}),s.jsx(d,{message:c.service_id})]}),s.jsx(k,{className:"col-span-full",services:i.subscription_use==="yes"&&l?[{id:`subscription-${l.id}`,name:((g=l.subscription)==null?void 0:g.name)||l.name,price:0}]:i.service_id.map(e=>{const o=t.find(r=>r.id===e);return{...o,price:o?o.price:0}})}),s.jsxs("div",{className:"flex justify-end font-bold text-lg col-span-full",children:["Total: $",i.service_id.reduce((e,o)=>{const r=t.find(u=>u.id===o);return e+(i.subscription_use==="yes"?0:parseFloat((r==null?void 0:r.price)||"0"))},0).toFixed(2)]}),s.jsxs("div",{className:"col-span-full",children:[s.jsx(n,{htmlFor:"notes",className:"my-2 block font-semibold text-gray-700",children:"Notas (Opcional)"}),s.jsx($,{id:"notes",type:"text",value:i.notes,onChange:e=>a("notes",e.target.value),className:"rounded-md"}),s.jsx(n,{htmlFor:"notes",className:"text-gray-500 text-sm",children:"Notas de la asistencia."}),s.jsx(d,{message:c.notes})]})]})}export{z as default};
