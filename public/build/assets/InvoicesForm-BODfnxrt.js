import{r as j,j as e}from"./app-D_aJPM6f.js";import{I as o}from"./input-error-KdBBeJEK.js";import{I as u}from"./input-Cu5kk2Gj.js";import{L as n}from"./label-CdWEZnM8.js";import{T as N,S as $,a as C,b as I,c as S,d as F}from"./select-Ce8HaS-o.js";import{B as v}from"./button-R9kz-4RF.js";import{S as k}from"./react-select.esm-DgyvaI7_.js";import"./utils-bRKmu4jq.js";import"./index-SMUsVaDm.js";import"./index-D6aSf3Ip.js";import"./index-CQ0SZu-X.js";import"./index-9yOvOks7.js";import"./Combination-ccpGFrUk.js";import"./floating-ui.dom-C5vApqfE.js";import"./chevron-down-DWbRnmBU.js";import"./createLucideIcon-BIFhNMr5.js";import"./check-DIvl0j2a.js";function K({data:a,setData:l,errors:m,patients:y,consultations:h,isEditing:q=!1}){const[d,_]=j.useState([]),b=y.map(t=>({value:t.id,label:`${t.name} ${t.lastname} (C.I: ${t.identification})`}));j.useEffect(()=>{if(a.patient_id){const t=h.filter(s=>s.patient_id===a.patient_id);_(t)}else _([])},[a.patient_id,h]);const x=()=>{l("items",[...a.items,{consultation_id:null,quantity:1,unit_price:0,line_total:0}])},f=t=>{const s=[...a.items];s.splice(t,1),l("items",s)},g=(t,s,c)=>{const i=[...a.items];if(i[t]={...i[t],[s]:c},s==="quantity"||s==="unit_price"){const r=i[t].quantity||0,p=i[t].unit_price||0;i[t].line_total=r*p}if(s==="consultation_id"&&c){const r=d.find(p=>p.id===parseInt(c));r&&(i[t].unit_price=r.amount,i[t].line_total=i[t].quantity*r.amount)}l("items",i)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:"invoice_number",children:"Número de Factura"}),e.jsx(u,{id:"invoice_number",type:"text",name:"invoice_number",value:a.invoice_number,className:"mt-1 block w-full",onChange:t=>l("invoice_number",t.target.value)}),e.jsx(o,{message:m.invoice_number,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:"patient_id",children:"Paciente"}),e.jsx(k,{id:"patient_id",options:b,value:b.find(t=>t.value===a.patient_id)||null,onChange:t=>l("patient_id",t?t.value:null),isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),e.jsx(o,{message:m.patient_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:"invoice_date",children:"Fecha de Factura"}),e.jsx(u,{id:"invoice_date",type:"date",name:"invoice_date",value:a.invoice_date,className:"mt-1 block w-full",onChange:t=>l("invoice_date",t.target.value)}),e.jsx(o,{message:m.invoice_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:"notes",children:"Notas"}),e.jsx(N,{id:"notes",name:"notes",value:a.notes,className:"mt-1 block w-full",onChange:t=>l("notes",t.target.value)}),e.jsx(o,{message:m.notes,className:"mt-2"})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-3",children:"Ítems de la Factura"}),a.items.map((t,s)=>{var c;return e.jsxs("div",{className:"border p-4 rounded-md mb-4 relative",children:[t.id&&e.jsx("input",{type:"hidden",name:`items[${s}][id]`,value:t.id}),e.jsx(v,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>f(s),children:"X"}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:`consultation_${s}`,children:"Consulta Asociada"}),e.jsxs($,{value:((c=t.consultation_id)==null?void 0:c.toString())||"",onValueChange:i=>g(s,"consultation_id",parseInt(i)),disabled:!a.patient_id||d.length===0,children:[e.jsx(C,{id:`consultation_${s}`,children:e.jsx(I,{placeholder:"Selecciona una consulta"})}),e.jsx(S,{children:d.map(i=>e.jsxs(F,{value:i.id.toString(),children:[i.scheduled_at," - ",i.patient?`${i.patient.name} ${i.patient.lastname}`:"Paciente no disponible"," (ID: ",i.id,") - $",i.amount]},i.id))})]}),!a.patient_id&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Selecciona un paciente para ver sus consultas."}),a.patient_id&&d.length===0&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No hay consultas disponibles para este paciente."}),e.jsx(o,{message:m[`items.${s}.consultation_id`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:`quantity_${s}`,children:"Cantidad"}),e.jsx(u,{id:`quantity_${s}`,type:"number",name:`items[${s}][quantity]`,value:t.quantity,className:"mt-1 block w-full bg-gray-100",onChange:i=>g(s,"quantity",parseInt(i.target.value)||0),min:"1",readOnly:!0}),e.jsx(o,{message:m[`items.${s}.quantity`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:`unit_price_${s}`,children:"Precio Unitario"}),e.jsx(u,{id:`unit_price_${s}`,type:"number",name:`items[${s}][unit_price]`,value:t.unit_price,className:"mt-1 block w-full bg-gray-100",readOnly:!0}),e.jsx(o,{message:m[`items.${s}.unit_price`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(n,{className:"my-2 block font-semibold text-gray-700",htmlFor:`line_total_${s}`,children:"Total de Línea"}),e.jsx(u,{id:`line_total_${s}`,type:"number",value:t.line_total,className:"mt-1 block w-full bg-gray-100",readOnly:!0})]})]},t.id||`new-${s}`)}),e.jsx(v,{type:"button",variant:"outline",onClick:x,className:"mt-4",children:"Agregar Ítem de Consulta"})]})}export{K as default};
