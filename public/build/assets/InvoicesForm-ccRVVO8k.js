import{r as b,j as e}from"./app-BI19IgvB.js";import{I as m}from"./input-error-CpdumXdR.js";import{I as d}from"./input-ps7vEDE0.js";import{L as l}from"./label-Bn6LoY71.js";import{T as N,S as $,a as C,b as I,c as S,d as F}from"./select-CkJ6U6Wc.js";import{B as v}from"./button-N-vKsxDA.js";import{S as k}from"./react-select.esm-DzcXGEHb.js";import"./utils-bRKmu4jq.js";import"./index-Dz4tCuRZ.js";import"./index-Cnh9NrWZ.js";import"./index-NOfg-_uz.js";import"./index-Bye_Dgf8.js";import"./Combination-Bw_21JTV.js";import"./floating-ui.dom-C5vApqfE.js";import"./chevron-down-CYfFHtHz.js";import"./createLucideIcon-iUzpHHvJ.js";import"./check-C9yi405w.js";function K({data:i,setData:n,errors:o,patients:y,consultations:h,isEditing:q=!1}){const[u,_]=b.useState([]),g=y.map(t=>({value:t.id,label:`${t.name} ${t.lastname} (C.I: ${t.identification})`}));b.useEffect(()=>{if(i.patient_id){const t=h.filter(s=>s.patient_id===i.patient_id);_(t)}else _([])},[i.patient_id,h]);const f=()=>{n("items",[...i.items,{consultation_id:null,description:"",quantity:1,unit_price:0,line_total:0}])},x=t=>{const s=[...i.items];s.splice(t,1),n("items",s)},j=(t,s,c)=>{const a=[...i.items];if(a[t]={...a[t],[s]:c},s==="quantity"||s==="unit_price"){const r=a[t].quantity||0,p=a[t].unit_price||0;a[t].line_total=r*p}if(s==="consultation_id"&&c){const r=u.find(p=>p.id===parseInt(c));r&&(a[t].description=`Consulta del ${r.scheduled_at}`,a[t].unit_price=r.amount,a[t].line_total=a[t].quantity*r.amount)}n("items",a)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:"patient_id",children:"Paciente"}),e.jsx(k,{id:"patient_id",options:g,value:g.find(t=>t.value===i.patient_id)||null,onChange:t=>n("patient_id",t?t.value:null),isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),e.jsx(m,{message:o.patient_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:"invoice_date",children:"Fecha de Factura"}),e.jsx(d,{id:"invoice_date",type:"date",name:"invoice_date",value:i.invoice_date,className:"mt-1 block w-full",onChange:t=>n("invoice_date",t.target.value)}),e.jsx(m,{message:o.invoice_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:"due_date",children:"Fecha de Vencimiento"}),e.jsx(d,{id:"due_date",type:"date",name:"due_date",value:i.due_date,className:"mt-1 block w-full",onChange:t=>n("due_date",t.target.value)}),e.jsx(m,{message:o.due_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:"notes",children:"Notas"}),e.jsx(N,{id:"notes",name:"notes",value:i.notes,className:"mt-1 block w-full",onChange:t=>n("notes",t.target.value)}),e.jsx(m,{message:o.notes,className:"mt-2"})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-3",children:"Ítems de la Factura"}),i.items.map((t,s)=>{var c;return e.jsxs("div",{className:"border p-4 rounded-md mb-4 relative",children:[t.id&&e.jsx("input",{type:"hidden",name:`items[${s}][id]`,value:t.id}),e.jsx(v,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>x(s),children:"X"}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:`consultation_${s}`,children:"Consulta Asociada"}),e.jsxs($,{value:((c=t.consultation_id)==null?void 0:c.toString())||"",onValueChange:a=>j(s,"consultation_id",parseInt(a)),disabled:!i.patient_id||u.length===0,children:[e.jsx(C,{id:`consultation_${s}`,children:e.jsx(I,{placeholder:"Selecciona una consulta"})}),e.jsx(S,{children:u.map(a=>e.jsxs(F,{value:a.id.toString(),children:[a.scheduled_at," - ",a.patient.name," ",a.patient.lastname," (ID: ",a.id,") - $",a.amount]},a.id))})]}),!i.patient_id&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Selecciona un paciente para ver sus consultas."}),i.patient_id&&u.length===0&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No hay consultas disponibles para este paciente."}),e.jsx(m,{message:o[`items.${s}.consultation_id`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:`quantity_${s}`,children:"Cantidad"}),e.jsx(d,{id:`quantity_${s}`,type:"number",name:`items[${s}][quantity]`,value:t.quantity,className:"mt-1 block w-full",onChange:a=>j(s,"quantity",parseInt(a.target.value)||0),min:"1"}),e.jsx(m,{message:o[`items.${s}.quantity`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:`unit_price_${s}`,children:"Precio Unitario"}),e.jsx(d,{id:`unit_price_${s}`,type:"number",name:`items[${s}][unit_price]`,value:t.unit_price,className:"mt-1 block w-full bg-gray-100",readOnly:!0}),e.jsx(m,{message:o[`items.${s}.unit_price`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(l,{className:"my-2 block font-semibold text-gray-700",htmlFor:`line_total_${s}`,children:"Total de Línea"}),e.jsx(d,{id:`line_total_${s}`,type:"number",value:t.line_total,className:"mt-1 block w-full bg-gray-100",readOnly:!0})]})]},t.id||`new-${s}`)}),e.jsx(v,{type:"button",variant:"outline",onClick:f,className:"mt-4",children:"Agregar Ítem de Consulta"})]})}export{K as default};
