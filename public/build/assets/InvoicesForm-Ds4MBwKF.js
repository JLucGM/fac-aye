import{j as e}from"./app-DG4aA9SL.js";import{I as m}from"./input-error-Cipe4zPI.js";import{I as u}from"./input-DWCzJmWe.js";import{L as r}from"./label-CciWg7BY.js";import{S as v}from"./react-select.esm-BXYZYRzm.js";import{B as g}from"./button-B2ggFSae.js";import{T as F}from"./textarea-5CfNB2hA.js";import{T as C,a as I,b as h,c as d,d as T,e as i}from"./table-CeY2YHMD.js";import{T as S}from"./trash-DyKq5SYd.js";import"./utils-bRKmu4jq.js";import"./index-DbAlyxNN.js";import"./index-B_bdB6qp.js";import"./floating-ui.dom-C5vApqfE.js";import"./createLucideIcon-CnQGTb1c.js";function J({data:t,setData:l,errors:n,patients:_,paymentMethods:N}){const p=_.map(a=>({value:a.id,label:`${a.name} ${a.lastname} (C.I: ${a.identification})`})),x=N.map(a=>({value:a.id,label:a.name})),b=()=>{l("items",[...t.items,{id:null,service_name:"",quantity:1,unit_price:0,line_total:0}])},f=a=>{const s=[...t.items];s.splice(a,1),l("items",s)},j=(a,s,c)=>{const o=[...t.items];if(o[a]={...o[a],[s]:c},s==="quantity"||s==="unit_price"){const w=o[a].quantity||0,$=o[a].unit_price||0;o[a].line_total=w*$}l("items",o)},y=()=>t.items.reduce((a,s)=>a+parseFloat(s.line_total),0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"invoice_number",children:"Número de Factura"}),e.jsx(u,{id:"invoice_number",type:"text",name:"invoice_number",value:t.invoice_number,className:"block w-full",onChange:a=>l("invoice_number",a.target.value)}),e.jsx(r,{htmlFor:"invoice_number",className:"text-gray-500 text-sm",children:"Se auto-generación de números de factura, puede personalizarlo."}),e.jsx(m,{message:n.invoice_number,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"invoice_date",children:"Fecha de Factura"}),e.jsx(u,{id:"invoice_date",type:"date",name:"invoice_date",value:t.invoice_date,className:"block w-full",onChange:a=>l("invoice_date",a.target.value)}),e.jsx(m,{message:n.invoice_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"patient_id",children:"Paciente"}),e.jsx(v,{id:"patient_id",options:p,value:p.find(a=>a.value===t.patient_id)||null,onChange:a=>{var s;return l("patient_id",a?a.value:((s=p[0])==null?void 0:s.value)||null)},isSearchable:!0,placeholder:"Selecciona un paciente...",className:"block w-full"}),e.jsx(m,{message:n.patient_id,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"payment_method_id",children:"Método de Pago"}),e.jsx(v,{id:"payment_method_id",options:x,value:x.find(a=>a.value===t.payment_method_id)||null,onChange:a=>{var s;return l("payment_method_id",a?a.value:((s=x[0])==null?void 0:s.value)||null)},isSearchable:!0,placeholder:"Selecciona un método de pago...",className:"block w-full"}),e.jsx(m,{message:n.payment_method_id,className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"notes",children:"Notas (opcional)"}),e.jsx(F,{id:"notes",name:"notes",value:t.notes,className:"mt-1 block w-full",onChange:a=>l("notes",a.target.value)}),e.jsx(r,{htmlFor:"notes",className:"text-gray-500 text-sm",children:"Notas sobre la factura."}),e.jsx(m,{message:n.notes,className:"mt-2"})]}),e.jsx("h3",{className:"text-lg font-semibold mt-6 mb-3",children:"Ítems de la Factura"}),e.jsx("div",{className:"overflow-x-auto rounded-md border",children:e.jsxs(C,{children:[e.jsx(I,{children:e.jsxs(h,{children:[e.jsx(d,{className:"w-[15%]",children:"Cantidad"}),e.jsx(d,{className:"w-[40%] text-right",children:"Descripción"}),e.jsx(d,{className:"w-[20%] text-right",children:"P. Unitario"}),e.jsx(d,{className:"w-[20%] text-right",children:"Total"}),e.jsx(d,{className:"w-[5%] text-right",children:"Acción"})]})}),e.jsxs(T,{children:[t.items.length===0?e.jsx(h,{children:e.jsx(i,{colSpan:5,className:"h-24 text-center",children:"No hay ítems en la factura."})}):t.items.map((a,s)=>e.jsxs(h,{children:[e.jsxs(i,{className:"text-right",children:[e.jsx(u,{id:`quantity_${s}`,type:"number",name:`items[${s}][quantity]`,value:a.quantity,className:"w-full",onChange:c=>j(s,"quantity",parseInt(c.target.value)||0),min:1}),e.jsx(m,{message:n[`items.${s}.quantity`],className:"mt-1"})]}),e.jsxs(i,{children:[e.jsx(u,{id:`service_name_${s}`,type:"text",name:`items[${s}][service_name]`,value:a.service_name,className:"w-full",onChange:c=>j(s,"service_name",c.target.value)}),e.jsx(m,{message:n[`items.${s}.service_name`],className:"mt-1"})]}),e.jsxs(i,{className:"text-right",children:[e.jsx(u,{id:`unit_price_${s}`,type:"number",name:`items[${s}][unit_price]`,value:a.unit_price,className:"w-full",onChange:c=>j(s,"unit_price",parseFloat(c.target.value)||0),min:0,step:"0.01"}),e.jsx(m,{message:n[`items.${s}.unit_price`],className:"mt-1"})]}),e.jsx(i,{className:"text-right",children:e.jsx(u,{id:`line_total_${s}`,type:"number",value:a.line_total,className:"w-full bg-gray-100 dark:bg-gray-800 text-right",readOnly:!0})}),e.jsx(i,{className:"text-right",children:e.jsx(g,{type:"button",variant:"destructive",size:"icon",onClick:()=>f(s),children:e.jsx(S,{className:"h-4 w-4"})})})]},a.id||`new-${s}`)),e.jsxs(h,{children:[e.jsx(i,{}),e.jsx(i,{}),e.jsx(i,{}),e.jsxs(i,{colSpan:1,className:"text-right font-semibold",children:["Total: $",y()]})]})]})]})}),e.jsx(g,{type:"button",variant:"outline",onClick:b,className:"mt-4",children:"Agregar Ítem"})]})}export{J as default};
