import{r as x,j as s}from"./app-DG4aA9SL.js";import{I as r}from"./input-error-Cipe4zPI.js";import{I as y}from"./input-DWCzJmWe.js";import{L as l}from"./label-CciWg7BY.js";import{S as f}from"./react-select.esm-BXYZYRzm.js";import w from"./ConsultationsTable-CEAmmCGv.js";import T from"./SubscriptionsTable-Cisul862.js";import"./utils-bRKmu4jq.js";import"./index-DbAlyxNN.js";import"./index-B_bdB6qp.js";import"./floating-ui.dom-C5vApqfE.js";import"./table-CeY2YHMD.js";function J({data:t,patients:b=[],paymentMethods:P,consultations:N=[],setData:a,errors:c}){const[d,j]=x.useState([]),[i,I]=x.useState("consulta"),_=Array.isArray(b)?b.map(e=>({value:Number(e.id),label:`${e.name} ${e.lastname} ( C.I: ${e.identification} )`})):[],S=P.map(e=>({value:e.id,label:e.name})),F=[{value:"pendiente",label:"Pendiente"},{value:"parcial",label:"Parcial"},{value:"pagado",label:"Pagado"},{value:"incobrable",label:"Incobrable"},{value:"reembolsado",label:"Reembolsado"}],C=e=>{let n,o;i==="consulta"?(n=[...t.consultation_ids||[]],o="consultation_ids",a("subscription_ids",[])):(n=[...t.subscription_ids||[]],o="subscription_ids",a("consultation_ids",[])),n.includes(e)?n=n.filter(p=>p!==e):n.push(e),a(o,n);const v=d.filter(p=>n.includes(p.id)).reduce((p,u)=>{let h=0;if(i==="consulta"){const m=typeof u.amount=="number"?u.amount:parseFloat(String(u.amount)),E=typeof u.amount_paid=="number"?u.amount_paid:parseFloat(String(u.amount_paid));h=m-(E||0)||0}else{const m=u;m.subscription&&m.subscription.price!==void 0&&(h=typeof m.subscription.price=="number"?m.subscription.price:parseFloat(String(m.subscription.price)))}return p+(isNaN(h)?0:h)},0);a("amount",v)},k=e=>{const n=e?e.value:null;a("patient_id",n),a("consultation_ids",[]),a("subscription_ids",[]),a("amount",0)};return x.useEffect(()=>{a("payment_type",i)},[i]),x.useEffect(()=>{if(t.patient_id){const e=b.find(n=>n.id===t.patient_id);if(i==="consulta"){const n=N.filter(o=>o.patient_id===t.patient_id&&o.payment_status!=="pagado");j(n)}else if(i==="suscripcion"){const o=((e==null?void 0:e.subscriptions)||[]).filter(g=>g.payment_status!=="pagado");j(o)}}else j([])},[t.patient_id,N,i,b]),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(l,{htmlFor:"payment_method_id",children:"Método de Pago"}),s.jsx(f,{id:"payment_method_id",options:S,value:S.find(e=>e.value===t.payment_method_id)||null,onChange:e=>a("payment_method_id",e?e.value:null),isSearchable:!0,placeholder:"Selecciona un método de pago...",className:"rounded-md mt-1 block w-full"}),s.jsx(r,{message:c.payment_method_id,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(l,{htmlFor:"status",className:"mb-2 block font-semibold text-gray-700",children:"Estado del pago"}),s.jsx(f,{id:"status",options:F,value:F.find(e=>e.value===t.status)||null,onChange:e=>a("status",(e==null?void 0:e.value)??""),isSearchable:!0,placeholder:"Select Status...",className:"rounded-md"}),s.jsx(r,{message:c.status})]})]}),s.jsxs("div",{children:[s.jsx(l,{htmlFor:"reference",children:"Referencia (opcional)"}),s.jsx(y,{id:"reference",type:"text",name:"reference",value:t.reference,className:"mt-1 block w-full",onChange:e=>a("reference",e.target.value)}),s.jsx(l,{htmlFor:"reference",className:"text-gray-500 text-sm",children:"Coloque número de referencia del pago."}),s.jsx(r,{message:c.reference,className:"mt-2"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.length>0&&s.jsxs("div",{children:[s.jsx(l,{htmlFor:"patient_id",className:"mb-2 block font-semibold text-gray-700",children:"Paciente"}),s.jsx(f,{id:"patient_id",options:_,value:_.find(e=>e.value===Number(t.patient_id))||null,onChange:k,isSearchable:!0,placeholder:"Selecciona un paciente...",className:"rounded-md"}),s.jsx(r,{message:c.patient_id})]}),s.jsxs("div",{children:[s.jsx(l,{htmlFor:"payment_type",className:"mb-2 block font-semibold text-gray-700",children:"Tipo de Pago"}),s.jsx(f,{id:"payment_type",options:[{value:"consulta",label:"Consulta"},{value:"suscripcion",label:"Funcional"}],value:{value:i,label:i==="consulta"?"Consulta":"Funcional"},onChange:e=>{I(e==null?void 0:e.value),a("consultation_ids",[]),a("subscription_ids",[]),a("amount",0)},isSearchable:!0,placeholder:"Selecciona un tipo de pago...",className:"rounded-md"})]})]}),i==="consulta"&&s.jsxs("div",{className:"mb-4",children:[s.jsx(l,{className:"mb-2 block font-semibold text-gray-700",children:"Consultas pendientes a pagar"}),d.length>0?s.jsx(w,{pendingConsultations:d,data:t,toggleConsultationSelection:C}):s.jsx("div",{className:"text-gray-500 text-sm mt-2",children:"No hay consultas pendientes de pago para este paciente."}),s.jsx(r,{message:c.consultation_ids})]}),i==="suscripcion"&&s.jsxs("div",{className:"mb-4",children:[s.jsx(l,{className:"mb-2 block font-semibold text-gray-700",children:"Funcionales pendientes a pagar"}),d.length>0?s.jsx(T,{pendingSubscriptions:d,data:t,toggleSubscriptionSelection:C}):s.jsx("div",{className:"text-gray-500 text-sm mt-2",children:"No hay Funcionales pendientes de pago para este paciente."}),s.jsx(r,{message:c.subscription_ids})]}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Deuda total seleccionada: $",d.filter(e=>i==="consulta"?t.consultation_ids.includes(e.id):t.subscription_ids.includes(e.id)).reduce((e,n)=>{var o;if(i==="consulta"){const g=typeof n.amount=="number"?n.amount:parseFloat(String(n.amount)),v=typeof n.amount_paid=="number"?n.amount_paid:parseFloat(String(n.amount_paid));return e+(g-(v||0)||0)}else return e+(((o=n.subscription)==null?void 0:o.price)??0)},0)]}),s.jsxs("div",{children:[s.jsx(l,{htmlFor:"amount",children:"Monto a pagar"}),s.jsx(y,{id:"amount",type:"number",name:"amount",value:t.amount,min:0,step:"0.01",className:"mt-1 block w-full",onChange:e=>{const n=e.target.value,o=n===""?0:parseFloat(n);!isNaN(o)&&o>=0&&a("amount",o)}}),s.jsx(r,{message:c.amount,className:"mt-2"})]}),s.jsxs("div",{children:[s.jsx(l,{htmlFor:"notes",children:"Notas (opcional)"}),s.jsx(y,{id:"notes",type:"text",name:"notes",value:t.notes,className:"mt-1 block w-full",onChange:e=>a("notes",e.target.value)}),s.jsx(l,{htmlFor:"notes",className:"text-gray-500 text-sm",children:"Notas sobre el pago."}),s.jsx(r,{message:c.notes,className:"mt-2"})]})]})}export{J as default};
